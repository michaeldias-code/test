<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palavras Cruzadas Interativo</title>
    <style>
        /* --- CSS Básico e Layout --- */
        :root {
            --grid-size: 30px; /* Tamanho da célula */
            --cor-letra: #34495e; 
            --cor-fundo: #ecf0f1; 
            --cor-celula: #fdfdfd; 
            --cor-acento: #3498db;
            --cor-selecao: #ffeaa7; /* Amarelo claro */
            --cor-destaque: #f1c40f; /* Amarelo escuro */
            --cor-borda: #bdc3c7;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--cor-fundo);
            color: var(--cor-letra);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        .game-container {
            width: 100%;
            max-width: 1000px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* --- Controles e Status --- */
        .controls-and-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #themeSelector {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--cor-borda);
        }

        /* --- Grid de Palavras Cruzadas --- */
        #crosswordGrid {
            display: grid;
            border: 1px solid var(--cor-borda);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .cell {
            width: var(--grid-size);
            height: var(--grid-size);
            background-color: var(--cor-celula);
            border: 1px solid var(--cor-borda);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-sizing: border-box;
        }

        .cell.empty {
            background-color: transparent;
            border: none;
            pointer-events: none; /* Não pode ser clicada */
        }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 1.2rem;
            text-transform: uppercase;
            font-weight: bold;
            color: var(--cor-letra);
            background: transparent;
            padding: 0;
            margin: 0;
            outline: none;
            caret-color: transparent; /* Remove o cursor de texto */
        }
        
        /* Destaque da célula ativa */
        .cell.active {
            background-color: var(--cor-selecao);
        }
        
        /* Destaque da palavra completa (todas as células relacionadas) */
        .cell.highlight {
            background-color: var(--cor-selecao);
        }
        
        /* Destaque do número da dica */
        .cell .number {
            position: absolute;
            top: 1px;
            left: 2px;
            font-size: 0.5rem;
            font-weight: bold;
            color: var(--cor-acento);
        }
        
        .cell.correct {
            background-color: #d1ffc9; /* Verde claro */
        }
        
        .cell.error {
            background-color: #ffcccc; /* Vermelho claro */
        }

        /* --- Área de Dicas --- */
        .clues-area {
            display: flex;
            margin-top: 20px;
            gap: 30px;
        }

        .clue-list {
            flex: 1;
        }

        .clue-list h3 {
            border-bottom: 2px solid var(--cor-acento);
            padding-bottom: 5px;
            color: var(--cor-acento);
        }
        
        .clue-list ul {
            list-style: none;
            padding: 0;
        }

        .clue-list li {
            margin-bottom: 10px;
            cursor: pointer;
            padding: 3px;
            border-radius: 3px;
        }

        .clue-list li.highlighted {
            background-color: var(--cor-destaque);
            font-weight: bold;
        }

        /* --- Responsividade --- */
        @media (max-width: 768px) {
            .clues-area {
                flex-direction: column;
                gap: 15px;
            }
            .game-container {
                padding: 10px;
            }
            .controls-and-status {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>Palavras Cruzadas Interativo</h1>

        <div class="controls-and-status">
            <label for="themeSelector">Escolha o Tema:</label>
            <select id="themeSelector"></select>
            <button onclick="checkAllWords()">Verificar Jogo</button>
        </div>

        <div class="content-wrapper">
            <div id="crosswordGrid"></div>

            <div class="clues-area">
                <div id="acrossClues" class="clue-list">
                    <h3>Horizontal</h3>
                    <ul></ul>
                </div>
                <div id="downClues" class="clue-list">
                    <h3>Vertical</h3>
                    <ul></ul>
                </div>
            </div>
        </div>

        <p id="message" style="margin-top: 20px; color: var(--cor-acento); font-weight: bold; display: none;"></p>
    </div>

    <script>
        // --- Estrutura de Dados do Jogo (Tema Fixo Inicial) ---

        // As palavras e suas dicas. A Posição é (linha, coluna) a partir de 0.
        const CROSSWORD_DATA = {
            "Tecnologia Básica": {
                size: 10, // Grid 10x10
                words: [
                    // Horizontal (H)
                    { id: 1, direction: 'H', start: [0, 0], word: "CODIGO", clue: "Conjunto de instruções para o computador." },
                    { id: 4, direction: 'H', start: [2, 2], word: "DADOS", clue: "Informação processada ou armazenada." },
                    { id: 6, direction: 'H', start: [4, 1], word: "CACHE", clue: "Memória de acesso rápido para dados frequentes." },
                    { id: 8, direction: 'H', start: [6, 4], word: "LOOP", clue: "Estrutura de repetição em programação." },
                    { id: 9, direction: 'H', start: [8, 0], word: "NUVEM", clue: "Armazenamento e processamento remoto (em inglês)." },

                    // Vertical (V)
                    { id: 2, direction: 'V', start: [0, 2], word: "IDEIA", clue: "Primeiro passo para um novo software." },
                    { id: 3, direction: 'V', start: [0, 5], word: "DRIVE", clue: "Dispositivo de armazenamento." },
                    { id: 5, direction: 'V', start: [2, 4], word: "SOFTWARE", clue: "Parte lógica do computador." },
                    { id: 7, direction: 'V', start: [4, 7], word: "HOST", clue: "Servidor que hospeda um site ou app." },
                ]
            },
            // Se você quiser mais temas, adicione aqui (ex: "Animais", "Geografia", etc.)
        };

        // --- Variáveis de Estado ---
        let currentTheme = null;
        let gridSize = 0;
        let activeCell = null;
        let activeWordDirection = 'H'; // Controla se o foco está na Horizontal ou Vertical

        // Elementos DOM
        const gridElement = document.getElementById('crosswordGrid');
        const themeSelector = document.getElementById('themeSelector');
        const messageElement = document.getElementById('message');
        
        // --- Funções de Inicialização e Renderização ---

        function initializeThemeSelector() {
            const themes = Object.keys(CROSSWORD_DATA);
            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme;
                themeSelector.appendChild(option);
            });

            // Carrega o primeiro tema por padrão
            loadTheme(themes[0]);
            
            themeSelector.addEventListener('change', (e) => loadTheme(e.target.value));
        }

        function loadTheme(themeName) {
            currentTheme = CROSSWORD_DATA[themeName];
            gridSize = currentTheme.size;
            renderGrid();
            renderClues();
            messageElement.style.display = 'none';
        }

        function renderGrid() {
            gridElement.innerHTML = '';
            gridElement.style.gridTemplateColumns = `repeat(${gridSize}, var(--grid-size))`;
            
            // Cria uma matriz para rastrear quais células estão preenchidas e quais palavras cruzam
            const cellMap = Array(gridSize).fill(0).map(() => Array(gridSize).fill(null));

            // 1. Preenche o CellMap com os dados das palavras
            currentTheme.words.forEach(wordData => {
                let [r, c] = wordData.start;
                const [dr, dc] = wordData.direction === 'H' ? [0, 1] : [1, 0];
                
                for (let i = 0; i < wordData.word.length; i++) {
                    const cell = cellMap[r][c] || { 
                        acrossWords: [], 
                        downWords: [], 
                        correctLetter: wordData.word[i] 
                    };

                    const directionKey = wordData.direction === 'H' ? 'acrossWords' : 'downWords';
                    
                    if (!cell[directionKey].includes(wordData.id)) {
                        cell[directionKey].push(wordData.id);
                    }
                    
                    // Adiciona o número da dica apenas na primeira célula da palavra
                    if (i === 0) {
                        cell.number = wordData.id;
                    }

                    cellMap[r][c] = cell;
                    r += dr;
                    c += dc;
                }
            });

            // 2. Renderiza o DOM
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cellData = cellMap[r][c];
                    
                    const cellEl = document.createElement('div');
                    cellEl.classList.add('cell');
                    cellEl.dataset.row = r;
                    cellEl.dataset.col = c;

                    if (cellData) {
                        // Adiciona o número da dica
                        if (cellData.number) {
                            const numSpan = document.createElement('span');
                            numSpan.classList.add('number');
                            numSpan.textContent = cellData.number;
                            cellEl.appendChild(numSpan);
                        }
                        
                        // Adiciona o campo de input
                        const inputEl = document.createElement('input');
                        inputEl.type = 'text';
                        inputEl.maxLength = 1;
                        inputEl.dataset.correct = cellData.correctLetter;
                        inputEl.dataset.across = cellData.acrossWords.join(',');
                        inputEl.dataset.down = cellData.downWords.join(',');
                        
                        inputEl.addEventListener('input', (e) => handleInput(e.target, r, c));
                        inputEl.addEventListener('focus', () => focusCell(r, c));
                        inputEl.addEventListener('click', (e) => toggleDirection(r, c));
                        inputEl.addEventListener('keydown', (e) => handleKeyDown(e, r, c));

                        cellEl.appendChild(inputEl);
                    } else {
                        cellEl.classList.add('empty');
                    }

                    gridElement.appendChild(cellEl);
                }
            }
        }

        function renderClues() {
            const acrossUl = document.querySelector('#acrossClues ul');
            const downUl = document.querySelector('#downClues ul');
            acrossUl.innerHTML = '';
            downUl.innerHTML = '';

            currentTheme.words
                .sort((a, b) => a.id - b.id)
                .forEach(wordData => {
                    const li = document.createElement('li');
                    li.id = `clue-${wordData.direction}-${wordData.id}`;
                    li.textContent = `${wordData.id}. ${wordData.clue}`;
                    li.dataset.id = wordData.id;
                    li.dataset.direction = wordData.direction;
                    
                    // Adiciona a funcionalidade de clique na dica para focar na palavra
                    li.addEventListener('click', () => {
                        const firstCell = getCellInput(wordData.start[0], wordData.start[1]);
                        if (firstCell) {
                            focusCell(wordData.start[0], wordData.start[1]);
                            activeWordDirection = wordData.direction;
                            highlightWord(wordData.id, wordData.direction);
                            firstCell.focus();
                        }
                    });

                    if (wordData.direction === 'H') {
                        acrossUl.appendChild(li);
                    } else {
                        downUl.appendChild(li);
                    }
                });
        }

        // --- Funções de Interatividade e Destaque ---

        function getCellInput(r, c) {
            const cellEl = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
            return cellEl ? cellEl.querySelector('input') : null;
        }

        function clearHighlights() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('active', 'highlight');
            });
            document.querySelectorAll('.clue-list li').forEach(li => {
                li.classList.remove('highlighted');
            });
        }

        function highlightWord(wordId, direction) {
            clearHighlights();
            
            // 1. Destaca as células da palavra
            document.querySelectorAll(`[data-${direction === 'H' ? 'across' : 'down'}~="${wordId}"]`)
                .forEach(input => {
                    input.closest('.cell').classList.add('highlight');
                });
            
            // 2. Destaca a célula ativa
            if (activeCell) {
                activeCell.closest('.cell').classList.add('active');
            }

            // 3. Destaca a dica na lista
            const clueEl = document.getElementById(`clue-${direction}-${wordId}`);
            if (clueEl) {
                clueEl.classList.add('highlighted');
            }
        }

        function focusCell(r, c) {
            clearHighlights();
            const inputEl = getCellInput(r, c);
            if (!inputEl) return;
            
            activeCell = inputEl;

            // Determina a palavra ativa:
            let activeId = null;
            
            if (activeWordDirection === 'H' && inputEl.dataset.across) {
                activeId = inputEl.dataset.across.split(',')[0]; 
            } else if (inputEl.dataset.down) {
                activeId = inputEl.dataset.down.split(',')[0];
                activeWordDirection = 'V'; // Assume Vertical se a horizontal não existir
            } else if (inputEl.dataset.across) {
                activeId = inputEl.dataset.across.split(',')[0];
                activeWordDirection = 'H'; // Assume Horizontal
            }
            
            if (activeId) {
                highlightWord(activeId, activeWordDirection);
            }
        }
        
        function toggleDirection(r, c) {
            const inputEl = getCellInput(r, c);
            if (!inputEl) return;

            // Se for um clique na célula já focada, alterna a direção
            if (inputEl === activeCell) {
                const isHorizontalAvailable = inputEl.dataset.across;
                const isVerticalAvailable = inputEl.dataset.down;

                if (isHorizontalAvailable && isVerticalAvailable) {
                    activeWordDirection = activeWordDirection === 'H' ? 'V' : 'H';
                } else if (isHorizontalAvailable) {
                    activeWordDirection = 'H';
                } else if (isVerticalAvailable) {
                    activeWordDirection = 'V';
                }
                
                focusCell(r, c);
            }
            inputEl.focus();
        }


        // --- Funções de Preenchimento e Navegação ---
        
        function handleInput(inputEl, r, c) {
            inputEl.value = inputEl.value.toUpperCase();
            
            // Limita a verificação de erro a 1 caractere
            inputEl.closest('.cell').classList.remove('correct', 'error');

            // Navegação automática para a próxima célula
            let [dr, dc] = activeWordDirection === 'H' ? [0, 1] : [1, 0];
            
            // Verifica a próxima célula
            let nextR = r + dr;
            let nextC = c + dc;
            let nextInput = getCellInput(nextR, nextC);

            // Continua buscando a próxima célula vazia na direção da palavra ativa
            while (nextR >= 0 && nextR < gridSize && nextC >= 0 && nextC < gridSize && nextInput && nextInput.value !== '') {
                nextR += dr;
                nextC += dc;
                nextInput = getCellInput(nextR, nextC);
            }

            if (nextInput) {
                nextInput.focus();
            } else {
                // Se chegou ao fim, foca novamente na célula atual para manter o destaque
                inputEl.focus(); 
            }
        }
        
        function handleKeyDown(e, r, c) {
            const key = e.key;
            let [dr, dc] = [0, 0];
            
            if (key === 'ArrowRight') { dc = 1; }
            else if (key === 'ArrowLeft') { dc = -1; }
            else if (key === 'ArrowDown') { dr = 1; }
            else if (key === 'ArrowUp') { dr = -1; }
            else if (key === 'Backspace' && e.target.value === '') { 
                // Se Backspace e a célula está vazia, move para a anterior
                [dr, dc] = activeWordDirection === 'H' ? [0, -1] : [-1, 0];
            } else {
                // Se for uma letra, deixa o handleInput cuidar da navegação
                return; 
            }
            
            e.preventDefault();
            
            const nextInput = getCellInput(r + dr, c + dc);
            if (nextInput) {
                nextInput.focus();
            }
        }

        // --- Funções de Verificação ---

        function checkWord(wordData) {
            let [r, c] = wordData.start;
            const [dr, dc] = wordData.direction === 'H' ? [0, 1] : [1, 0];
            let isCorrect = true;

            for (let i = 0; i < wordData.word.length; i++) {
                const inputEl = getCellInput(r, c);
                if (inputEl.value !== inputEl.dataset.correct) {
                    isCorrect = false;
                    break;
                }
                r += dr;
                c += dc;
            }
            
            // Atualiza o estado visual das células verificadas
            r = wordData.start[0];
            c = wordData.start[1];

            for (let i = 0; i < wordData.word.length; i++) {
                const cellEl = getCellInput(r, c).closest('.cell');
                cellEl.classList.remove('correct', 'error');
                if (cellEl.querySelector('input').value !== '') {
                     cellEl.classList.add(isCorrect ? 'correct' : 'error');
                }
                r += dr;
                c += dc;
            }

            return isCorrect;
        }

        function checkAllWords() {
            let totalCorrect = 0;
            const totalWords = currentTheme.words.length;
            
            currentTheme.words.forEach(wordData => {
                if (checkWord(wordData)) {
                    totalCorrect++;
                }
            });

            if (totalCorrect === totalWords) {
                messageElement.textContent = "Parabéns! Você resolveu o Palavras Cruzadas!";
                messageElement.style.color = '#2ecc71'; // Verde
            } else {
                messageElement.textContent = `Faltam ${totalWords - totalCorrect} palavras. Continue tentando!`;
                messageElement.style.color = '#e74c3c'; // Vermelho
            }
            messageElement.style.display = 'block';
        }

        // --- Inicialização ---

        window.onload = initializeThemeSelector;

    </script>
</body>
</html>
