<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Nivelamento de Python Profissional</title>
    <link rel="stylesheet" href="style.css"> <!-- Link para o seu CSS -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Teste de Nivelamento de Python</h1>
            <p>Avalia√ß√£o Profissional Completa</p>
        </div>

        <div id="welcomeScreen" class="welcome-screen">
            <h2>Bem-vindo ao Teste de Python!</h2>
            <p style="color: #666; font-size: 18px; margin: 20px 0;">
                Este √© um teste profissional que avaliar√° seu n√≠vel de Python do b√°sico ao avan√ßado.
            </p>
            <ul>
                <li>‚úì <strong>30 quest√µes</strong> cuidadosamente selecionadas</li>
                <li>‚úì Avalia√ß√£o completa <strong></strong></li>
                <li>‚úì Tempo limite: <strong>50 minutos</strong></li>
                <!--<li>‚úì <strong>Listening</strong>: 3 quest√µes de compreens√£o auditiva</li>
                <li>‚úì <strong>Writing</strong>: Quest√µes de escrita e digita√ß√£o</li>
                <li>‚úì Gram√°tica, vocabul√°rio e compreens√£o de texto</li>-->
                <li>‚úì Quest√µes variadas a cada tentativa</li>
            </ul>
            <button class="btn-primary" onclick="startTest()">Iniciar Teste</button>
        </div>

        <div id="testArea" class="test-area">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="timer-section">
                <div class="timer">
                    <span>‚è±Ô∏è</span>
                    <span id="timer">50:00</span>
                </div>
                <div class="question-counter" id="questionCounter">Quest√£o 1 de 30</div>
            </div>

            <div class="question-card" id="questionCard"></div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">‚Üê Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Pr√≥xima ‚Üí</button>
                <button class="btn btn-finish" id="finishBtn" onclick="finishTest()" style="display: none;">Finalizar Teste</button>
            </div>
        </div>

        <div id="results" class="results"></div>
    </div>



<!-- üîπ IMPORTANTE: questionBank vem ANTES -->
<script src="questionBank_py.js"></script>

<script>
/* =========================
   VARI√ÅVEIS GERAIS
========================= */
let currentQuestion = 0;
let selectedQuestions = [];
let answers = {};
let timeLeft = 3000;
let timerInterval;
let audioPlayCount = {};

/* =========================
   UTILIT√ÅRIOS
========================= */
function shuffleArray(array) {
    const a = [...array];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function speakText(text) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'en-US';
    speechSynthesis.speak(u);
}

/* =========================
   IN√çCIO DO TESTE
========================= */
function startTest() {
    const basic = shuffleArray(questionBank.basic).slice(0, 10);
    const intermediate = shuffleArray(questionBank.intermediate).slice(0, 10);
    const advanced = shuffleArray(questionBank.advanced).slice(0, 10);

    selectedQuestions = [...basic, ...intermediate, ...advanced];

    selectedQuestions.forEach((q, i) => {
        if (q.isListening) audioPlayCount[i] = 0;
    });

    document.getElementById('welcomeScreen').style.display = 'none';
    document.getElementById('testArea').style.display = 'block';

    startTimer();
    displayQuestion();
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        document.getElementById('timer').textContent =
            `${m}:${s.toString().padStart(2, '0')}`;

        if (timeLeft <= 0) finishTest();
    }, 1000);
}

/* =========================
   RENDERIZA√á√ÉO
========================= */
function displayQuestion() {
    const q = selectedQuestions[currentQuestion];
    const card = document.getElementById('questionCard');
    card.innerHTML = '';

    document.getElementById('questionCounter').textContent =
        `Quest√£o ${currentQuestion + 1} de ${selectedQuestions.length}`;

    document.getElementById('progressFill').style.width =
        `${((currentQuestion + 1) / selectedQuestions.length) * 100}%`;

    card.innerHTML += `<h3>${q.level} ‚Ä¢ ${q.type}</h3>`;
    card.innerHTML += `<p>${q.question || ''}</p>`;

    if (q.passage) {
        card.innerHTML += `<blockquote>${q.passage}</blockquote>`;
    }

    if (q.isListening) {
        card.innerHTML += `
            <button onclick="playAudio(${currentQuestion})">
                ‚ñ∂Ô∏è Ouvir √°udio (${audioPlayCount[currentQuestion] || 0}/2)
            </button>
        `;
    }

    if (q.isWriting) {
        card.innerHTML += `
            <textarea oninput="saveWritingAnswer(this.value)">
                ${answers[currentQuestion] || ''}
            </textarea>
        `;
    }

    if (q.options) {
        q.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option';
            div.textContent = opt;
            if (answers[currentQuestion] === i) div.classList.add('selected');
            div.onclick = () => selectOption(i);
            card.appendChild(div);
        });
    }
}

/* =========================
   INTERA√á√ïES
========================= */
function selectOption(i) {
    answers[currentQuestion] = i;
    displayQuestion();
}

function saveWritingAnswer(v) {
    answers[currentQuestion] = v.toLowerCase().trim();
}

function playAudio(i) {
    if (audioPlayCount[i] >= 2) return;
    audioPlayCount[i]++;
    speakText(selectedQuestions[i].audioText);
    displayQuestion();
}

function nextQuestion() {
    if (currentQuestion < selectedQuestions.length - 1) {
        currentQuestion++;
        displayQuestion();
    }
}

function previousQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        displayQuestion();
    }
}

/* =========================
   FINALIZA√á√ÉO
========================= */
function finishTest() {
    clearInterval(timerInterval);
    document.getElementById('testArea').style.display = 'none';

    let score = 0;

    selectedQuestions.forEach((q, i) => {
        const ans = answers[i];
        if (q.isWriting && ans) {
            if (q.correctAnswers.some(c => ans.includes(c))) score++;
        }
        if (q.options && ans === q.correct) score++;
    });

    showResults(score);
}

function showResults(score) {
    const percent = Math.round((score / selectedQuestions.length) * 100);
    document.getElementById('results').style.display = 'block';
    document.getElementById('results').innerHTML =
        `<h2>Resultado: ${percent}% (${score}/${selectedQuestions.length})</h2>`;
}
</script>
</body>
</html>
